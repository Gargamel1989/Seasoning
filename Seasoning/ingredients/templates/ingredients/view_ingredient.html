{% extends "base.html" %}
{% load markdown_filter %}

{% block title %}Ingredienten{% endblock %}

{% block extra_script %}
<script>
$(function() {
    $("#ingredient-availability").height(parseInt($("#number-of-groups").text())*30 + 25);
    var offset_top = 20;
    var first = true;
    $(".available-in").each(function() {
    	$(this).css("top", offset_top);
        offset_top = offset_top + 30;
        var extra_top = 0;
        if (first) {
    		$(this).css('border-top', '1px solid #DDD');
    		$(this).css('padding-top', '10px');
    		first = false;
    		offset_top = offset_top + 10;
    		extra_top = 10;
    	}
        $(this).children(".availability-indicator").each(function() {
            var from = parseInt($(this).children(".available-from").text());
            var until = parseInt($(this).children(".available-until").text());
            var total_width = $(".month.alpha").width() * 12 + 11;
            var from_point = total_width * (from/365);
            var until_point = total_width * (until/365);
            var left_margin = parseInt($(".month.alpha").css("margin-left").replace("px", ""));
            $(this).html("");
            if (from < until) {
                $(this).css("left", from_point + left_margin)
                $(this).css("width", until_point - from_point);
            	$(this).css("top", extra_top + "px");
            } else {
                var second_indicator = $(this).clone();
                $(this).css("left", left_margin);
                $(this).css("width", until_point);
            	$(this).css("top", extra_top + "px");
                second_indicator.insertAfter($(this));
                second_indicator.css("left", from_point + left_margin);
                second_indicator.css("width", total_width - from_point);
            	second_indicator.css("top", extra_top + "px");
            }
        });
        
    });
});
</script>
{% endblock %}

{% block ingredients-active %}active{% endblock %}

{% block content %}

<h1>
    {{ ingredient.name }}{% if ingredient.synonyms.all %}<span id="ingredient-synonyms">{% for synonym in ingredient.synonyms.all %}, {{ synonym.name }}{% endfor %}</span>{% endif %}
</h1>

<img id="ingredient-image" src="{{ ingredient.image.url }}">

<p>
    <strong>Categorie:</strong> {{ ingredient.get_category_display }}
</p>
<p>
    <strong>Veganisme:</strong> {{ ingredient.get_veganism_display }}
</p>
<p>
    <strong>Voetafdruk:</strong> {{ ingredient.footprint|floatformat:2 }} kgCO2/{{ ingredient.primary_unit.short }}
</p>
{% if ingredient.type == 1 or ingredient.type == 2 %}
<p>
    <strong>Bewaarbaarheid:</strong> {{ ingredient.preservability }} dagen
</p>
<p>
    <strong>Uitstoot tijdens bewaring:</strong> {{ ingredient.preservation_footprint|floatformat     }} kgCO2/dag
</p>
{% endif %}

<p>
    <strong>Beschrijving:</strong><br />
    {{ ingredient.description|markdown|safe }}
</p>

<br class="clear" />

{% if ingredient.conservation_tip %}
<p>
    <strong>Bewaringstip:</strong><br />
    {{ ingredient.conservation_tip|markdown|safe }}
</p>
{% endif %}

{% if ingredient.preparation_tip %}
<p>
    <strong>Bereidingstip:</strong><br />
    {{ ingredient.preparation_tip|markdown|safe }}
</p>
{% endif %}

{% if ingredient.properties %}
<p>
    <strong>Speciale Eigenschappen:</strong><br />
    {{ ingredient.properties|markdown|safe }}
</p>
{% endif %}

{% if ingredient.type == 1 or ingredient.type == 2 %}
<strong>Beschikbaarheidsdata:</strong>
<div id="ingredient-availability">
    <span class="month alpha">
        Jan
    </span><span class="month">
        Feb
    </span><span class="month">
        Maa
    </span><span class="month">
        Apr
    </span><span class="month">
        Mei
    </span><span class="month">
        Jun
    </span><span class="month">
        Jul
    </span><span class="month">
        Aug
    </span><span class="month">
        Sep
    </span><span class="month">
        Okt
    </span><span class="month">
        Nov
    </span><span class="month omega">
        Dec
    </span>
    
    {% regroup ingredient.get_available_ins by location.name as available_in_locations %}
    <span id="number-of-groups" style="display:none;">{{ available_in_locations|length }}</span>
    {% for available_in_location in available_in_locations %}
    <div class="available-in" id="available-in-{{ available_in_location.grouper }}">
        <span class="location-name">{{ available_in_location.grouper }}</span>
        {% for available_in in available_in_location.list %}
        <span class="availability-indicator" title="Dit ingredient is beschikbaar in {{ available_in.location }} van {{ available_in.month_from }} tot {{ available_in.month_until }}.{% if available_in.production_type %} Dit ingredient wordt op een speciale wijze geproduceerd: {{ available_in.production_type }}{% endif %}">
            <span class="available-from">{{ available_in.date_from.timetuple.tm_yday }}</span>
            <span class="available-until">{{ available_in.date_until.timetuple.tm_yday }}</span>
        </span>
        {% endfor %}
    </div>
    {% endfor %}
</div>

<p>
    <strong>Bronnen:</strong><br />
    {{ ingredient.source|linebreaks }}
</p>

{% endif %}

{% endblock %}
