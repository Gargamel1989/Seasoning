{% extends "recipes/edit_recipe_base.html" %}

{% block extra_script %}
{{ block.super }}
<script src="/static/js/forms.js" type="text/javascript"></script>
<script src="/static/js/edit_recipe_ingredients.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
        $("#request_ings-button").click(function() {
            $("#id_ingredients-ingredients_general_info-request_unknown_ingredients").val("True");
        })
    });
</script>
{% endblock %}

{% block recipe-form %}

<p>
    Hier geef je meer informatie op over de ingrediënten die gebruikt worden in je recept.
</p>

{% if wizard.form.ingredients.unknown_ingredients %}
{% if wizard.form.ingredients_general_info.request_unknown_ingredients.value %}
{{ wizard.form.ingredients_general_info.request_unknown_ingredients.as_hidden }}
{% else %}
Je hebt ongekende ingredienten gebruikt:
<ul>
    {% for unknown_ingredient in wizard.form.ingredients.unknown_ingredients %}
    <li>{{ unknown_ingredient.name }}</li>
    {% endfor %}
</ul>
Wil je deze ingrediënten aanvragen?
{{ wizard.form.ingredients_general_info.request_unknown_ingredients.as_hidden }}
<button id="request_ings-button" value="request_ingredients" type="submit" name="request_ingredients">Ingrediënten aanvragen</button>

{% endif %}
{% else %}
{{ wizard.form.ingredients.non_form_errors }}
{% endif %}


<div id="portions-field" class="field-wrapper tooltip-field">
        {{ wizard.form.ingredients_general_info.portions.label_tag }}
        <div class="spinner-wrapper">
           {{ wizard.form.ingredients_general_info.portions }}
        </div>
        <div class="tooltip">{{ wizard.form.ingredients_general_info.portions.help_text }}</div>
        
        {% if wizard.form.ingredients_general_info.portions.errors %}        
            {{ wizard.form.ingredients_general_info.portions.errors }} 
        {% endif %}
      </div>
      
      <div id="extra_info-field" class="field-wrapper tooltip-field">
        {{ wizard.form.ingredients_general_info.extra_info.label_tag }}
        
        <div class="input-wrapper">
           {{ wizard.form.ingredients_general_info.extra_info }}
        </div>
        <div class="tooltip">{{ wizard.form.ingredients_general_info.extra_info.help_text }}</div>
        
        {% if wizard.form.ingredients_general_info.extra_info.errors %}        
            {{ wizard.form.ingredients_general_info.extra_info.errors }} 
        {% endif %}
      </div>
      
      <div id="ingredient-field" class="field-wrapper tooltip-field">
        <label>Ingrediënten</label>
        
          {% if wizard.form.ingredients.non_form_errors %}
                <br style="margin-top: 20px;" />
                {{ wizard.form.ingredients.non_form_errors }} 
          {% endif %}
          
          <div id="uses-formset" class="formset">
              {% regroup wizard.form.ingredients by group.value as usesingredient_groups %}
              {{ wizard.form.ingredients.management_form }}
              <ul id="sortable-ingredients">
                  <li class="column-labels sorting-disabled">
                    <span class="name-label">Naam</span>
                    <span class="amount-label">Hoeveelheid</span>
                    <span class="unit-label">Eenheid</span>
                    <span class="delete-label">Verwijderen</span>
                  </li>
                  {% for group in usesingredient_groups %}
                  {% if group.grouper != "" and group.grouper != None %}
                  <li class="group">
                    <span class="definition">
                        <span class="move-handle"> </span>
                        <span class="delete-button-wrapper">
                            <a href="#" class="delete-button"> </a>
                        </span>
                        <span class="group-name-wrapper">
                            <strong>Ingrediëntgroep: </strong><input type="text" placeholder="(Geef groepsnaam in)" class="group-name" value="{{ group.grouper }}" />
                        </span>
                    </span>
                    <span class="labels">
                        <span class="name-label">Naam</span>
                        <span class="amount-label">Hoeveelheid</span>
                        <span class="unit-label">Eenheid</span>
                        <span class="delete-label">Verwijderen</span>
                    </span>
                  </li>
                  {% endif %}
                  {% for form in group.list %}
                  {{ form.non_field_errors }}
                  {% if forloop.parentloop.last or form.ingredient.value or form.amount.value or form.unit.value %}
                  <li class="ingredient">
                    <span class="move-handle"> </span>
                    <span class="ingredient-name">{{ form.id }}{{ form.group }}{{ form.ingredient }}</span>
                    <span class="ingredient-amount">{{ form.amount }}</span>
                    <span>{{ form.unit }}</span>
                    <span><a href="#" class="delete-button">{{ form.DELETE.as_hidden }}</a></span>
                    <span class="ingredient-errors">
                        <span class="ingredient-name-errors error">{{ form.group.errors }}{{ form.ingredient.errors }}</span>
                        <span class="ingredient-amount-errors error">{{ form.amount.errors }}</span>
                        <span class="ingredient-unit-errors error">{{ form.unit.errors }}</span>
                    </span>
                    <br class="clear" />
                  </li>
                  {% endif %}
                  {% endfor %}
                  {% endfor %}
                  <li class="group empty-form sorting-disabled">
                    <span class="definition">
                        <span class="move-handle"> </span>
                        <span class="delete-button-wrapper">
                            <a href="#" class="delete-button"> </a>
                        </span>
                        <span class="group-name-wrapper">
                            <strong>Ingrediëntgroep: </strong><input type="text" placeholder="(Geef groepsnaam in)" class="group-name" />
                        </span>
                    </span>
                    <span class="labels">
                        <span class="name-label">Naam</span>
                        <span class="amount-label">Hoeveelheid</span>
                        <span class="unit-label">Eenheid</span>
                        <span class="delete-label">Verwijderen</span>
                    </span>
                  </li>
                  <li class="colum-labels empty-form sorting-disabled">
                    <span>Naam</span>
                    <span>Hoeveelheid</span>
                    <span>Eenheid</span>
                    <span>Verwijderen</span>
                  </li>
                  <li class="ingredient empty-form sorting-disabled">
                    <span class="move-handle"> </span>
                    <span class="ingredient-name">{{ wizard.form.ingredients.empty_form.id }}{{ wizard.form.ingredients.empty_form.group }}{{ wizard.form.ingredients.empty_form.ingredient }}</span>
                    <span class="ingredient-amount">{{ wizard.form.ingredients.empty_form.amount }}</span>
                    <span>{{ wizard.form.ingredients.empty_form.unit }}</span>
                    <span class="delete-button"> </span>
                  </li>
              </ul>
              <div class="button-group">
                  <a href="#" class="add-button add-ingredient-button">Ingrediënt toevoegen</a>
                  <a href="#" class="add-button add-ingredientgroup-button">Ingrediëntengroep toevoegen</a>
              </div>
          </div>
          
      </div>
{% endblock %}
