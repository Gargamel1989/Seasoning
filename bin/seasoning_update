# Copyright 2012, 2013 Driesen Joep
# 
# This file is part of Seasoning.
# 
# Seasoning is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# Seasoning is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with Seasoning.  If not, see <http://www.gnu.org/licenses/>.
#     

#!/bin/sh

cd $SEASONING_HOME/seasoning_website
git fetch -q origin master
git fetch -qt origin master


if [ -n "$1" ]; then
  git tag | grep -q $1
  if [[ $? -eq 0 ]]; then
    SEASONING_VERSION=$1
  else
    echo "Requested version does not exist, using version $SEASONING_VERSION"
  fi
else
  . /etc/profile.d/seasoning.sh
fi

git checkout -qf $SEASONING_VERSION

$SEASONING_HOME/seasoning_env/bin/pip install -r $SEASONING_HOME/seasoning_website/requirements/virtualenv_requirements.txt | grep -v "Requirement already satisfied"

sh $SEASONING_HOME/seasoning_website/environment/prepare_and_install_seasoning_source.sh $SEASONING_VERSION

# Collect static files
$SEASONING_HOME/seasoning_env/bin/python $SEASONING_HOME/seasoning_website/Seasoning/manage.py collectstatic
