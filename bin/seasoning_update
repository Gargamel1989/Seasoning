#!/bin/sh

cd $SEASONING_HOME/seasoning_website
git fetch -q origin master
git fetch -qt origin master


if [ -n "$1" ]; then
  git tag | grep -q $1
  if [[ $? -eq 0 ]]; then
    SEASONING_VERSION=$1
  else
    echo "Requested version does not exist, using version $SEASONING_VERSION"
  fi
fi

git checkout -q $SEASONING_VERSION

$SEASONING_HOME/seasoning_env/bin/pip install -r $SEASONING_HOME/seasoning_website/requirements/virtualenv_requirements.txt | grep -v "Requirement already satisfied"

sh $SEASONING_HOME/seasoning_website/environment/prepare_and_install_seasoning_source.sh

# Collect static files
$SEASONING_HOME/seasoning_env/bin/python $SEASONING_HOME/seasoning_website/Seasoning/manage.py collectstatic

export $SEASONING_VERSION